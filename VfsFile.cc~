#include"VfsFile.h"
#include<iostream>
#include<string>
#include<cstring>
#include<fstream>
#include<sstream>
using namespace std;

VfsFile::VfsFile()
{
	char *data_bytes='\0';
}
void VfsFile::exportfile(string reponame, fstream &ext, int offset, long bytes)
{
	
	fstream constr;
	//cout << "reponame="<<offset<<","<<bytes<<endl;
	constr.open(reponame,  ios::in | ios::out | ios::binary );
	if(!constr.good())
		{
		cout << "Stream not good"<<endl;}

	char buffer[1024];
	//cout << "Creating " <<  endl;
	int count = (bytes/1024);

	constr.seekg(offset, ios::beg);
	for(int i = 0; i < count; i++)
		{
		constr.read(buffer,1024);
		//cout<<"data:"<<buffer<<endl;
		ext.write(buffer,1024);
		}
	//cout<<"done"<<endl;
	int rem = bytes%1024;
	//cout << "rem="<<rem<<endl;
	constr.read(buffer,rem);
	
	//cout<<"data:"<<buffer<<endl;
	ext.write(buffer,rem);
	
	constr.close();
	ext.close();
}
VfsFile::~VfsFile()
{
}
void VfsFile::SaveInVfs(string reponame, fstream &ext, int &offset , long &size)
{
	char buffer[1024];
	

	// Open containter file in output binary mode
	fstream constr;
	int si=1024;
	ext.seekg(0,ios::end);
	size = ext.tellg();
	ext.seekg(0, ios::beg);
	// Just create the file using output mode if it does not exist
	constr.open(reponame, ios::in | ios::out | ios::binary  );
	//cout<<reponame<<endl;
	constr.seekp(0,ios::end);
	if( !constr.good() ){
		cout << "Stream not good " << endl;
		exit(1);
	}

	offset = constr.tellp();
	while (!ext.eof())
	{
	
	ext.read(buffer,si);
	//cout<<buffer<<endl;
	constr.write(buffer,si);
	}
	
	ext.close();
	constr.close();	
}
